{% extends 'detection/base.html' %}
{% load static %}
{% block title %} Alerts Page {% endblock title %}
{% block content %}
<main>
    <div class="container-fluid mt-3">
        <h2 class="text-center mb-4">Real-Time Crime Alerts</h2>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <ul id="alertsList" class="list-group list-group-flush"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const alertsList = document.getElementById("alertsList");
        const ws = new WebSocket("ws://127.0.0.1:8000/ws/alerts/");
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            const listItem = document.createElement("li");
            listItem.classList.add("list-group-item", "border-start", "border-danger", "border-4");
            
            listItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="fw-bold text-danger">Alert</div>
                        <div>${data.message}</div>
                        <small class="text-muted">${data.timestamp}</small>
                    </div>
                    ${data.image_url ? `
                        <div class="ms-3">
                            <img src="${data.image_url}" class="img-fluid rounded" style="max-width: 200px" alt="Alert image">
                        </div>
                    ` : ''}
                </div>
            `;
            
            alertsList.insertBefore(listItem, alertsList.firstChild);
        };
    </script>
</main>
{% endblock content %}